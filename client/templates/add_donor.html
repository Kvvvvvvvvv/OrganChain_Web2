<!DOCTYPE html>
<html>
<head>
    <title>Add Donor</title>
    <link rel="stylesheet" href="../static/style.css">
</head>
<body>
<nav class="navbar">
    <div class="nav-container">
        <a class="brand" href="/login">Organ Donor Chain</a>
        <ul class="nav-links">
            <li><a href="/logout">Logout</a></li>
        </ul>
    </div>
</nav>

<section class="hero">
    <div class="hero-inner">
        <h1>Honor the Gift of Life</h1>
        <p>Register donor details to power ethical, life-saving transplants.</p>
    </div>
</section>

<div class="container">
    <h2>Add Donor</h2>
    <form id="donorForm" method="POST">
        <div class="form-group">
            <label>Name</label>
            <input type="text" name="name" required>
        </div>
        
        <div class="form-group">
            <label>Age</label>
            <input type="number" name="age" required>
        </div>
        
        <div class="form-group">
            <label>Gender</label>
            <select name="gender">
                <option value="Male">Male</option>
                <option value="Female">Female</option>
            </select>
        </div>
        
        <div class="form-group">
            <label>Blood Type</label>
            <select name="blood_type" required>
                <option value="">Select Blood Type</option>
                <option value="A+">A+</option>
                <option value="A-">A-</option>
                <option value="B+">B+</option>
                <option value="B-">B-</option>
                <option value="AB+">AB+</option>
                <option value="AB-">AB-</option>
                <option value="O+">O+</option>
                <option value="O-">O-</option>
            </select>
        </div>
        
        <div class="form-group">
            <label>Organ</label>
            <select name="organ">
                <option value="Kidney">Kidney</option>
                <option value="Heart">Heart</option>
                <option value="Lungs">Lungs</option>
                <option value="Liver">Liver</option>
                <option value="Pancreas">Pancreas</option>
                <option value="Intestine">Intestine</option>
            </select>
        </div>
        
        <button type="submit" class="btn btn-primary">Add Donor</button>
    </form>
</div>

<!-- Success Popup -->
<div class="popup-overlay" style="display: none;">
    <div class="popup">
        <h3>âœ… Success!</h3>
        <p class="popup-message"></p>
        <div class="unique-id">Unique ID: <span id="uniqueId"></span></div>
        <button class="close-popup">Close</button>
    </div>
</div>

<script>
document.getElementById('donorForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Add loading state
    const submitButton = this.querySelector('button[type="submit"]');
    const originalText = submitButton.textContent;
    submitButton.textContent = 'Adding...';
    submitButton.disabled = true;
    
    const formData = new FormData(this);
    
    fetch('/add_donor', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showSuccessPopup(data.message, data.unique_id);
            // Reset form
            this.reset();
        } else {
            alert('Error: ' + (data.message || 'Failed to add donor'));
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error: Failed to add donor');
    })
    .finally(() => {
        // Remove loading state
        submitButton.textContent = originalText;
        submitButton.disabled = false;
    });
});

function showSuccessPopup(message, uniqueId) {
    const overlay = document.querySelector('.popup-overlay');
    const popup = document.querySelector('.popup');
    const popupMessage = document.querySelector('.popup-message');
    const uniqueIdElement = document.getElementById('uniqueId');
    
    popupMessage.textContent = message;
    uniqueIdElement.textContent = uniqueId;
    
    overlay.style.display = 'block';
    
    // Auto close after 5 seconds
    setTimeout(() => {
        closePopup();
    }, 5000);
}

function closePopup() {
    const overlay = document.querySelector('.popup-overlay');
    overlay.style.display = 'none';
}

// Close popup when clicking close button
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('close-popup')) {
        closePopup();
    }
});

// Close popup when clicking overlay
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('popup-overlay')) {
        closePopup();
    }
});
</script>

</body>
</html>